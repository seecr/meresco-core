extend('utils')

inputNamespace='http://www.imsglobal.org/xsd/imsmd_v1p2'

rootTagName='lom'

defaultNameSpace='http://ltsc.ieee.org/xsd/LOM'

# namespaces for use in XPath expressions in rules
sourceNsMap = {
'imsmd': inputNamespace
}

rules = [
('general/identifier/catalog', 'imsmd:general/imsmd:catalogentry/imsmd:catalog', ('.',), '%s'),

('general/identifier/entry', 'imsmd:general/imsmd:catalogentry/imsmd:entry', ('imsmd:langstring',), '%s'),
('general/identifier/entry', 'imsmd:general/imsmd:catalogentry/imsmd:entry', ('imsmd:langstring/imsmd:value',), '%s'),

('general/title', 'imsmd:general/imsmd:title', ('imsmd:langstring/@xml:lang', 'imsmd:langstring'), '<string language="%s">%s</string>'),
('general/title', 'imsmd:general/imsmd:title', ('imsmd:langstring[not(@xml:lang) and not(imsmd:language)]',), '<string language="x-none">%s</string>'),
('general/title', 'imsmd:general/imsmd:title', ('imsmd:langstring/imsmd:language', 'imsmd:langstring/imsmd:value'), '<string language="%s">%s</string>'),

('general/language', 'imsmd:general/imsmd:grouplanguage', ('.',), '%s'),
('general/language', 'imsmd:general/imsmd:language', ('.',), '%s'),

('general/description', 'imsmd:general/imsmd:description', ('imsmd:langstring/@xml:lang', 'imsmd:langstring'), '<string language="%s">%s</string>'),
('general/description', 'imsmd:general/imsmd:description', ('imsmd:langstring[not(@xml:lang) and not(imsmd:language)]',), '<string language="x-none">%s</string>'),
('general/description', 'imsmd:general/imsmd:description', ('imsmd:langstring/imsmd:language', 'imsmd:langstring/imsmd:value'), '<string language="%s">%s</string>'),

('general/keyword', 'imsmd:general/imsmd:keyword', ('imsmd:langstring/@xml:lang', 'imsmd:langstring'), '<string language="%s">%s</string>'),
('general/keyword', 'imsmd:general/imsmd:keyword', ('imsmd:langstring[not(@xml:lang) and not(imsmd:language)]',), '<string language="x-none">%s</string>'),
('general/keyword', 'imsmd:general/imsmd:keyword', ('imsmd:langstring/imsmd:language', 'imsmd:langstring/imsmd:value'), '<string language="%s">%s</string>'),

('general/aggregationLevel/source', 'imsmd:general/imsmd:aggregationlevel/imsmd:source', ('imsmd:langstring',), '%s'),
('general/aggregationLevel/value', 'imsmd:general/imsmd:aggregationlevel/imsmd:value', ('imsmd:langstring',), '%s', [('(.*)', '%s', (str.lower,))]),

('lifeCycle/version', 'imsmd:lifecycle/imsmd:version', ('imsmd:langstring/@xml:lang', 'imsmd:langstring',), '<string language="%s">%s</string>'),
('lifeCycle/version', 'imsmd:lifecycle/imsmd:version', ('imsmd:langstring[not(@xml:lang)]',), '<string language="x-none">%s</string>'),
('lifeCycle/status/source', 'imsmd:lifecycle/imsmd:status/imsmd:source', ('imsmd:langstring',), '%s'),
('lifeCycle/status/value', 'imsmd:lifecycle/imsmd:status/imsmd:value', ('imsmd:langstring',), '%s', [('(.*)', '%s', (str.lower,))]),
('lifeCycle/contribute/role/source', 'imsmd:lifecycle/imsmd:contribute/imsmd:role/imsmd:source', ('imsmd:langstring',), '%s',),
('lifeCycle/contribute/role/source', 'imsmd:lifecycle/imsmd:contribute/imsmd:role/imsmd:source', ('imsmd:langstring/imsmd:value',), '%s',),
('lifeCycle/contribute/role/value', 'imsmd:lifecycle/imsmd:contribute/imsmd:role/imsmd:value', ('imsmd:langstring',), '%s',
		[('(.*)', '%s', (str.lower,))]),
('lifeCycle/contribute/role/value', 'imsmd:lifecycle/imsmd:contribute/imsmd:role/imsmd:value', ('imsmd:langstring/imsmd:value',), '%s',
		[('(.*)', '%s', (str.lower,))]),

('lifeCycle/contribute', 'imsmd:lifecycle/imsmd:contribute', ('imsmd:centity/imsmd:vcard',), '<entity>%s</entity>',
		rewriteVcard),
('lifeCycle/contribute/date', 'imsmd:lifecycle/imsmd:contribute/imsmd:date', ('imsmd:datetime',), '<dateTime>%s</dateTime>',
	rewriteDate),




('metaMetadata/metadataSchema', 'imsmd:metametadata[1]/imsmd:metadatascheme[1]', ('.',), '%s'),
('metaMetadata/contribute/role/source', 'imsmd:metametadata/imsmd:contribute/imsmd:role/imsmd:source', ('imsmd:langstring/imsmd:value',), '%s',),
('metaMetadata/contribute/role/source', 'imsmd:metametadata/imsmd:contribute/imsmd:role/imsmd:source', ('imsmd:langstring[not(imsmd:value)]',), '%s',),
('metaMetadata/contribute/role/value', 'imsmd:metametadata/imsmd:contribute/imsmd:role/imsmd:value', ('imsmd:langstring',), '%s',
		[('(.*)', '%s', (str.lower,))]),
('metaMetadata/contribute/role/value', 'imsmd:metametadata/imsmd:contribute/imsmd:role/imsmd:value', ('imsmd:langstring/imsmd:value',), '%s',
		[('(.*)', '%s', (str.lower,))]),

('metaMetadata/contribute', 'imsmd:metametadata/imsmd:contribute', ('imsmd:centity/imsmd:vcard',), '<entity>%s</entity>',
		rewriteVcard),
('metaMetadata/contribute/date', 'imsmd:metametadata/imsmd:contribute/imsmd:date', ('imsmd:datetime',), '<dateTime>%s</dateTime>',
	rewriteDate),




('technical/format', 'imsmd:technical/imsmd:format', ('.',), '%s',
		[('^$', 'application/octet-stream', (str,))]),
('technical/location', 'imsmd:technical/imsmd:location', ('.',), '%s'),
('technical/location', 'imsmd:technical/imsmd:location', ('imsmd:value',), '%s'),

('educational/learningResourceType/source', 'imsmd:educational/imsmd:learningresourcetype/imsmd:source', ('imsmd:langstring/imsmd:value',), '%s'),
# especially for some onderwijsrepository.nl repositories, the following hack was made.
('educational/learningResourceType/source', 'imsmd:educational/imsmd:learningresourcetype/imsmd:source', ('imsmd:langstring[not(imsmd:value)]',), '%s'),
('educational/learningResourceType/value', 'imsmd:educational/imsmd:learningresourcetype/imsmd:value', ('imsmd:langstring/imsmd:value',), '%s'),
('educational/learningResourceType/value', 'imsmd:educational/imsmd:learningresourcetype/imsmd:value', ('imsmd:langstring[not(imsmd:value)]',), '%s'),
('educational/context/source', 'imsmd:educational/imsmd:context/imsmd:source', ('imsmd:langstring/imsmd:value',), '%s'),
('educational/context/source', 'imsmd:educational/imsmd:context/imsmd:source', ('imsmd:langstring[not(imsmd:value)]',), '%s'),
('educational/context/value', 'imsmd:educational/imsmd:context/imsmd:value', ('imsmd:langstring/imsmd:value',), '%s'),
('educational/context/value', 'imsmd:educational/imsmd:context/imsmd:value', ('imsmd:langstring[not(imsmd:value)]',), '%s'),
('educational/interactivityType/source', 'imsmd:educational/imsmd:interactivitytype/imsmd:source', ('imsmd:langstring/imsmd:value',), '%s'),
('educational/interactivityType/source', 'imsmd:educational/imsmd:interactivitytype/imsmd:source', ('imsmd:langstring[not(imsmd:value)]',), '%s'),
('educational/interactivityType/value', 'imsmd:educational/imsmd:interactivitytype/imsmd:value', ('imsmd:langstring/imsmd:value',), '%s'),
('educational/interactivityType/value', 'imsmd:educational/imsmd:interactivitytype/imsmd:value', ('imsmd:langstring[not(imsmd:value)]',), '%s'),

('rights/cost/source', 'imsmd:rights/imsmd:cost/imsmd:source', ('imsmd:langstring/imsmd:value',), '%s'),
('rights/cost/source', 'imsmd:rights/imsmd:cost/imsmd:source', ('imsmd:langstring[not(imsmd:value)]',), '%s'),
('rights/cost/value', 'imsmd:rights/imsmd:cost/imsmd:value', ('imsmd:langstring/imsmd:value',), '%s'),
('rights/cost/value', 'imsmd:rights/imsmd:cost/imsmd:value', ('imsmd:langstring[not(imsmd:value)]',), '%s'),

('rights/copyrightAndOtherRestrictions/source', 'imsmd:rights/imsmd:copyrightandotherrestrictions/imsmd:source', ('imsmd:langstring',), '%s'),
('rights/copyrightAndOtherRestrictions/source', 'imsmd:rights/imsmd:copyrightandotherrestrictions/imsmd:source', ('imsmd:langstring/imsmd:value',), '%s'),
('rights/copyrightAndOtherRestrictions/value', 'imsmd:rights/imsmd:copyrightandotherrestrictions/imsmd:value', ('imsmd:langstring',), '%s',
		[('.*/(yes|no|by|by-nd|by-nc-nd|by-nc|by-nc-sa|by-sa)/.*', '%s')]),
('rights/copyrightAndOtherRestrictions/value', 'imsmd:rights/imsmd:copyrightandotherrestrictions/imsmd:value', ('imsmd:langstring/imsmd:value',), '%s',
		[('.*/(yes|no|by|by-nd|by-nc-nd|by-nc|by-nc-sa|by-sa)/.*', '%s')]),
('rights/description', 'imsmd:rights/imsmd:description[position()=1]', ('imsmd:langstring/@xml:lang', 'imsmd:langstring',), '<string language="%s">%s</string>'),
('rights/description', 'imsmd:rights/imsmd:description[position()=1]', ('imsmd:langstring[not(@xml:lang)]',), '<string language="x-none">%s</string>'),

('classification/purpose/source',
	'imsmd:classification/imsmd:purpose/imsmd:source',
	('imsmd:langstring',), '%s'),
('classification/purpose/value',
	'imsmd:classification/imsmd:purpose/imsmd:value',
	('imsmd:langstring',), '%s'),

('classification/taxonPath/source',
	'imsmd:classification/imsmd:taxonpath/imsmd:source',
	('imsmd:langstring/@xml:lang', 'imsmd:langstring'), '<string language="%s">%s</string>'),
('classification/taxonPath/taxon/id',
	'imsmd:classification/imsmd:taxonpath/imsmd:taxon/imsmd:id',
	('.',), '%s',
    [('(.*)', '%s', (str.strip,))]
	),
('classification/taxonPath/taxon/entry',
	'imsmd:classification/imsmd:taxonpath/imsmd:taxon/imsmd:entry',
	('imsmd:langstring/@xml:lang', 'imsmd:langstring'), '<string language="%s">%s</string>',
    [('(.*)', '%s', (str.strip,))]
	),
]

# delete imported stuff
del rewriteVcard
del rewriteDate
